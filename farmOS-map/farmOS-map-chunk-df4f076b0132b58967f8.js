(self.webpackChunk_farmos_org_farmos_map=self.webpackChunk_farmos_org_farmos_map||[]).push([[723],{2832:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>F});var a=n(9530),s=n(7644),i=n(3381),r=n(2445),o=n(1273),l=n(1577),c=n(9194),h=n(141),d=n(7016),g=n(8426),u=n(4109),m=n(686),w=n(8813),v=n(7673);class f extends a.default{constructor(e){const t=e||{};super({element:document.createElement("div"),target:t.target});const{element:n}=this,a=t.className||"ol-edit";n.className=`${a} ${s.XV} ${s.hg}`;const i=document.createElement("div");i.className="ol-edit-buttons draw",n.appendChild(i);const r=document.createElement("div");r.className="ol-edit-buttons actions",n.appendChild(r),this.buttons={};const o=[{name:"polygon",label:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>',tooltip:"Draw a Polygon",draw:"Polygon",element:i},{name:"line",label:'<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><path d="M23,8c0,1.1-0.9,2-2,2c-0.18,0-0.35-0.02-0.51-0.07l-3.56,3.55C16.98,13.64,17,13.82,17,14c0,1.1-0.9,2-2,2s-2-0.9-2-2 c0-0.18,0.02-0.36,0.07-0.52l-2.55-2.55C10.36,10.98,10.18,11,10,11s-0.36-0.02-0.52-0.07l-4.55,4.56C4.98,15.65,5,15.82,5,16 c0,1.1-0.9,2-2,2s-2-0.9-2-2s0.9-2,2-2c0.18,0,0.35,0.02,0.51,0.07l4.56-4.55C8.02,9.36,8,9.18,8,9c0-1.1,0.9-2,2-2s2,0.9,2,2 c0,0.18-0.02,0.36-0.07,0.52l2.55,2.55C14.64,12.02,14.82,12,15,12s0.36,0.02,0.52,0.07l3.55-3.56C19.02,8.35,19,8.18,19,8 c0-1.1,0.9-2,2-2S23,6.9,23,8z"/></svg>',tooltip:"Draw a Line",draw:"LineString",element:i},{name:"point",label:"â€¢",tooltip:"Draw a Point",draw:"Point",element:i},{name:"circle",label:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/></svg>',tooltip:"Draw a Circle",draw:"Circle",element:i},{name:"modify",label:'<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><path d="M 23,7 V 1 H 17 V 3 H 7 V 1 H 1 V 7 H 3 V 17 H 1 v 6 h 6 v -2 h 10 v 2 h 6 V 17 H 21 V 7 Z M 3,3 H 5 V 5 H 3 Z M 5,21 H 3 V 19 H 5 Z M 17,19 H 7 V 17 H 5 V 7 H 7 V 5 h 10 v 2 h 2 v 10 h -2 z m 4,2 h -2 v -2 h 2 z M 19,5 V 3 h 2 v 2 z"/></svg>',tooltip:"Modify features",element:r},{name:"move",label:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/></svg>',tooltip:"Move features",element:r},{name:"delete",label:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z"/></svg>',tooltip:"Delete selected feature",visible:!1,element:r}];for(let e=0;e<o.length;e+=1)this.buttons[o[e].name]=this.addButton(o[e].element,o[e]);this.layer=t.layer,this.eventListeners={drawstart:[],drawend:[],modifystart:[],modifyend:[],translatestart:[],translating:[],translateend:[],select:[],delete:[],disable:[]}}addButton(e,t){const{label:n,tooltip:a}=t,s=document.createElement("button");return s.name=t.name,s.className=`ol-edit-${t.name}`,s.type="button",s.title=a,s.innerHTML=n,!1===t.visible&&(s.style.display="none"),t.draw&&(s.draw=t.draw),s.addEventListener(i.Z.CLICK,this.handleClick.bind(this),!1),e.appendChild(s),s}handleClick(e){if(e.preventDefault(),e.target.name)if(this.buttons[e.target.name].classList.contains("active"))this.disableAll();else{if("delete"===e.target.name)return this.selectInteraction.getFeatures().forEach((e=>{this.layer.getSource().removeFeature(e),this.snapInteraction&&this.snapInteraction.removeFeature(e)})),this.selectInteraction.getFeatures().clear(),this.eventListeners.delete.forEach((({cb:e,format:t})=>{e(t.writeFeatures(this.getFeatures(),w.Z))})),void this.toggleDeleteButton(!1);this.disableAll(),this.toggleActiveButton(e.target.name),this.enableEscape(),["point","line","polygon","circle"].includes(e.target.name)?(this.enableDraw(e.target.draw),this.enableSnap()):"modify"===e.target.name?(this.enableSelect(),this.enableModify(),this.enableSnap()):"move"===e.target.name&&(this.enableSelect(),this.enableMove())}}handleEscape(e){"Escape"===e.key&&(this.disableAll(),document.removeEventListener(i.Z.KEYDOWN,this.handleEscape,!1))}enableDraw(e){let t;"Circle"===e&&(t=(0,r.N_)(100)),this.drawInteraction=new r.ZP({source:this.layer.getSource(),type:e,geometryFunction:t}),this.getMap().addInteraction(this.drawInteraction),Object.entries(this.eventListeners).forEach((([e,t])=>{["drawstart","drawend"].includes(e)&&t.forEach((({cb:t,format:n})=>{this.drawInteraction.on(e,(e=>{const a=n.writeFeatures(this.getFeatures().concat(e.feature),w.Z);t(a,e)}))}))})),this.drawInteraction.on("drawend",(e=>{e.feature&&this.snapInteraction&&this.snapInteraction.addFeature(e.feature)}))}enableSelect(){this.selectInteraction||(this.selectInteraction=new o.Z({layers:[this.layer]}),Object.entries(this.eventListeners).forEach((([e,t])=>{["select"].includes(e)&&t.forEach((({cb:t,format:n})=>{this.selectInteraction.on(e,(e=>{const a=n.writeFeatures(e.selected,w.Z);t(a,e)}))}))})),this.selectInteraction.on("select",(e=>{e.selected.length?this.toggleDeleteButton(!0):this.toggleDeleteButton(!1)}))),this.getMap().addInteraction(this.selectInteraction)}enableModify(){this.modifyInteraction||(this.modifyInteraction=new l.Z({features:this.selectInteraction.getFeatures()}),Object.entries(this.eventListeners).forEach((([e,t])=>{["modifystart","modifyend"].includes(e)&&t.forEach((({cb:t,format:n})=>{this.modifyInteraction.on(e,(e=>{const a=n.writeFeatures(this.getFeatures(),w.Z);t(a,e)}))}))}))),this.getMap().addInteraction(this.modifyInteraction)}enableMove(){this.translateInteraction||(this.translateInteraction=new c.Z({features:this.selectInteraction.getFeatures()}),Object.entries(this.eventListeners).forEach((([e,t])=>{["translatestart","translating","translateend"].includes(e)&&t.forEach((({cb:t,format:n})=>{this.translateInteraction.on(e,(e=>{const a=n.writeFeatures(this.getFeatures(),w.Z);t(a,e)}))}))}))),this.getMap().addInteraction(this.translateInteraction)}enableSnap(){this.snapInteraction||(this.snapInteraction=new h.Z({features:this.layer.getSource().getFeaturesCollection()||new g.Z}),(0,v.Z)(this.getMap().getLayerGroup(),(e=>{if("function"==typeof e.getSource){const t=e.getSource();if("null"!==t&&t instanceof d.default){const e=t.getFeatures();"ready"===t.getState()&&e.length>0&&e.forEach((e=>{this.snapInteraction.addFeature(e)}))}}}))),this.getMap().addInteraction(this.snapInteraction)}enableEscape(){this.handleEscape=this.handleEscape.bind(this),document.addEventListener(i.Z.KEYDOWN,this.handleEscape,!1)}disableAll(){["drawInteraction","modifyInteraction","selectInteraction","snapInteraction","translateInteraction"].forEach((e=>{this[e]&&("selectInteraction"===e&&this[e].getFeatures().clear(),this.getMap().removeInteraction(this[e]))})),this.toggleActiveButton(!1,!1),this.toggleDeleteButton(!1),this.eventListeners.disable.forEach((({cb:e,format:t})=>{e(t.writeFeatures(this.getFeatures(),w.Z))}))}toggleActiveButton(e,t=!0){Object.keys(this.buttons).forEach((n=>{this.buttons[n].name===e&&t?this.buttons[n].classList.add("active"):this.buttons[n].classList.remove("active")}))}toggleDeleteButton(e){this.buttons.delete.style.display=e?"block":"none"}addInteractionListener(e,t,n=new u.Z){const a=["drawstart","drawend","modifystart","modifyend","translatestart","translating","translateend","select","delete","disable"];if(!a.includes(e))throw new Error(`Invalid event type. Valid options include: ${a.join(", ")}`);this.eventListeners[e].includes({cb:t,format:n})||this.eventListeners[e].push({cb:t,format:n})}getFeatures(){return this.layer.getSource().getFeatures()}getWKT(){return(new m.Z).writeFeatures(this.getFeatures(),w.Z)}getGeoJSON(){const e=this.layer.getSource().getFeatures();return(new u.Z).writeFeatures(e,w.Z)}wktOn(e,t){this.formatOn(e,t,new m.Z)}geoJSONOn(e,t){this.formatOn(e,t,new u.Z)}formatOn(e,t,n){"featurechange"!==e?this.addInteractionListener(e,t,n):["drawend","modifyend","translating","translateend","delete"].forEach((e=>{this.addInteractionListener(e,t,n)}))}}const p=f;var b=n(8057),y=n(4194),I=n(4110);function E(e,t,n){const a=(0,y.DE)(e,t,n),{length:s}=a,i=n>1?n:2;for(let e=0;e<s;e+=i)a[e]%=360,a[e]<-180&&(a[e]+=360),a[e]>180&&(a[e]-=360);return a}const F={attach(e,{layer:t}={}){!function(){const e=(0,b.get)("EPSG:3857"),t=(0,b.get)("EPSG:4326");(0,I.Od)(e,t),(0,I.IH)(e,t,E)}();const n=t||e.addLayer("vector",{title:"Drawing",group:"Editable layers",color:"orange"}),a="us"===e.options.units?"us":"metric";e.edit=new p({layer:n,units:a}),e.map.addControl(e.edit)}}}}]);